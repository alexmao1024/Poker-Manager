<view class="screen">
  <view class="stack">
    <view class="header fade-in">
      <view class="profile-center">
        <button
          class="avatar-btn"
          open-type="chooseAvatar"
          bindchooseavatar="onChooseAvatar"
          hover-class="none"
        >
          <image wx:if="{{profile.avatar}}" class="avatar" src="{{profile.avatar}}" mode="aspectFill" />
          <view wx:else class="avatar avatar-placeholder">{{profileInitial}}</view>
        </button>
        <view class="profile-name editable" bindtap="openNicknameModal">{{profile.name}}</view>
        <view class="profile-hint">点击头像选择微信头像</view>
      </view>
      <view class="header-title">
        <view class="title">筹码计分</view>
        <view class="subtitle">线下筹码记分房间</view>
        <view wx:if="{{versionText}}" class="version-text">{{versionText}}</view>
      </view>
    </view>

    <view class="action-panel fade-in delay-1">
      <view class="action-stack">
        <button class="btn btn-home btn-home-primary" bindtap="toggleCreate" disabled="{{!!existingRoom}}">
          {{showCreate ? "收起表单" : "新建房间"}}
        </button>
        <button class="btn btn-home btn-home-secondary" bindtap="toggleJoin">
          {{showJoin ? "收起加入" : "加入房间"}}
        </button>
        <button class="btn btn-home btn-home-secondary" bindtap="openMyRoom" disabled="{{!existingRoom}}">
          进入我的房间
        </button>
      </view>
      <view class="action-meta" wx:if="{{existingRoom}}">
        房间号 #{{existingRoom.code}}
      </view>
    </view>

    <view wx:if="{{showCreate}}" class="panel form-panel fade-in delay-2">
      <view class="form-row">
        <text class="form-label">玩法</text>
        <view class="segmented">
          <button
            class="segmented-btn {{form.gameType === 'texas' ? 'is-active' : ''}}"
            data-type="texas"
            bindtap="onSelectGameType"
          >
            德州
          </button>
          <button
            class="segmented-btn {{form.gameType === 'zhajinhua' ? 'is-active' : ''}}"
            data-type="zhajinhua"
            bindtap="onSelectGameType"
          >
            炸金花
          </button>
        </view>
      </view>
      <view class="form-row">
        <text class="form-label">座位数</text>
        <input class="form-input" type="number" placeholder="2 - 12" value="{{form.seatCount}}" bindinput="onInputSeatCount" />
      </view>
      <view class="form-grid" wx:if="{{form.gameType === 'texas'}}">
        <view class="form-row">
          <text class="form-label">起始积分</text>
          <input class="form-input" type="number" value="{{form.stack}}" bindinput="onInputStack" />
        </view>
        <view class="form-row">
          <text class="form-label">小盲积分</text>
          <input class="form-input" type="number" value="{{form.sb}}" bindinput="onInputSb" />
        </view>
        <view class="form-row">
          <text class="form-label">大盲积分</text>
          <input class="form-input" type="number" value="{{form.bb}}" bindinput="onInputBb" />
        </view>
      </view>
      <view class="form-grid" wx:else>
        <view class="form-row">
          <text class="form-label">底注</text>
          <input class="form-input" type="number" value="{{form.zhjBaseBet}}" bindinput="onInputZhjBaseBet" />
        </view>
        <view class="form-row">
          <text class="form-label">买入积分</text>
          <input class="form-input" type="number" value="{{form.zhjBuyIn}}" bindinput="onInputZhjBuyIn" />
        </view>
        <view class="form-row">
          <text class="form-label">封顶轮数</text>
          <input class="form-input" type="number" value="{{form.zhjMaxRounds}}" bindinput="onInputZhjMaxRounds" />
        </view>
        <view class="form-row">
          <text class="form-label">最早看牌轮数</text>
          <input class="form-input" type="number" value="{{form.zhjMinSeeRound}}" bindinput="onInputZhjMinSeeRound" />
        </view>
        <view class="form-row">
          <text class="form-label">最早比牌轮数</text>
          <input class="form-input" type="number" value="{{form.zhjCompareAfter}}" bindinput="onInputZhjCompareAfter" />
        </view>
      </view>
      <button class="btn btn-home btn-home-primary form-submit" bindtap="createTable" disabled="{{!!existingRoom}}">
        进入房间
      </button>
    </view>

    <view wx:if="{{showJoin}}" class="panel form-panel fade-in delay-2">
      <view class="form-row">
        <text class="form-label">房间号</text>
        <input class="form-input" placeholder="6 位数字" value="{{joinCode}}" bindinput="onInputJoin" />
      </view>
      <button class="btn btn-home btn-home-primary form-submit" bindtap="joinTable">进入房间</button>
    </view>

  </view>

  <view wx:if="{{showNicknameModal}}" class="nickname-modal">
    <view class="modal-card">
      <view class="modal-title">设置昵称</view>
      <input
        class="modal-input"
        type="nickname"
        placeholder="请输入昵称"
        value="{{nicknameDraft}}"
        focus="{{showNicknameModal}}"
        bindinput="onNicknameInput"
      />
      <view class="modal-actions">
        <button class="btn btn-ghost" bindtap="closeNicknameModal">取消</button>
        <button class="btn btn-primary" bindtap="confirmNickname">确定</button>
      </view>
    </view>
  </view>
</view>
